<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Dispute Solver - Automated Conflict Resolution</title>
    <link rel="stylesheet" href="../css/main.css" />
    <meta name="description" content="AI-powered dispute resolution platform for automated conflict analysis and winner determination" />
    <meta name="keywords" content="AI dispute resolution, conflict analysis, automated mediation, legal technology" />
<script type="module" src="https://static.rocket.new/rocket-web.js?_cfg=https%3A%2F%2Faidispute6494back.builtwithrocket.new&_be=https%3A%2F%2Fapplication.rocket.new&_v=0.1.8"></script>
</head>
<body class="bg-background min-h-screen dark:bg-dark-background dark:text-dark-text-primary">
    <!-- Header Section -->
    <header class="bg-surface dark:bg-dark-surface shadow-soft border-b border-border dark:border-dark-border">
        <div class="container mx-auto px-4 py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-primary dark:bg-dark-primary rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <h1 class="text-2xl font-inter font-bold text-text-primary dark:text-dark-text-primary">AI Dispute Solver</h1>
                </div>
                <div class="hidden md:flex items-center space-x-4">
                    <span class="text-sm text-text-secondary dark:text-dark-text-secondary">Powered by Advanced AI Analysis</span>
                    <div class="w-2 h-2 bg-success-500 dark:bg-dark-success-500 rounded-full animate-pulse-soft"></div>
                    <button id="theme-toggle" type="button" class="text-text-secondary dark:text-dark-text-secondary hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5">
                        <svg id="theme-toggle-dark-icon" class="w-5 h-5 animate-rotate-in" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                        <svg id="theme-toggle-light-icon" class="hidden w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.707.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" fill-rule="evenodd" clip-rule="evenodd"></path></svg>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Introduction Section -->
        <section class="text-center mb-12 animate-fade-in">
            <div class="max-w-3xl mx-auto">
                <h2 class="text-3xl font-inter font-bold text-text-primary dark:text-dark-text-primary mb-4">
                    Resolve Disputes with AI-Powered Analysis
                </h2>
                <p class="text-lg text-text-secondary dark:text-dark-text-secondary leading-relaxed">
                    Our advanced AI system analyzes both sides of a dispute, reviews supporting documents, and provides an impartial assessment with detailed reasoning and confidence scoring. Perfect for preliminary dispute analysis and neutral perspective evaluation.
                </p>
            </div>
        </section>

        <!-- Dispute Input Form -->
        <section class="max-w-4xl mx-auto animate-slide-up">
            <div class="card-elevated dark:bg-dark-surface dark:border-dark-border">
                <form id="disputeForm" class="space-y-8">
                    <!-- Party A Story Input -->
                    <div class="space-y-3">
                        <label for="storyA" class="block text-lg font-inter font-semibold text-text-primary dark:text-dark-text-primary">
                            <div class="flex items-center space-x-2">
                                <div class="w-6 h-6 bg-primary-100 dark:bg-dark-primary-100 text-primary-600 dark:text-dark-primary-600 rounded-full flex items-center justify-center text-sm font-bold">A</div>
                                <span>Your Story (Party A)</span>
                            </div>
                        </label>
                        <textarea id="storyA" name="storyA" rows="10" class="input-field dark:bg-dark-surface dark:border-dark-border dark:text-dark-text-primary dark:placeholder-dark-text-secondary resize-none" placeholder="Please provide your detailed perspective of the dispute. Include relevant facts, timeline of events, your position, and any important context that supports your case. Be as specific and objective as possible." required></textarea>
                        <div class="flex justify-between text-sm text-text-secondary dark:text-dark-text-secondary">
                            <span>Minimum 50 characters recommended</span>
                            <span id="countA" class="font-mono">0 characters</span>
                        </div>
                    </div>

                    <!-- Party B Story Input -->
                    <div class="space-y-3">
                        <label for="storyB" class="block text-lg font-inter font-semibold text-text-primary dark:text-dark-text-primary">
                            <div class="flex items-center space-x-2">
                                <div class="w-6 h-6 bg-accent-100 dark:bg-dark-accent-100 text-accent-600 dark:text-dark-accent-600 rounded-full flex items-center justify-center text-sm font-bold">B</div>
                                <span>Other Party's Story (Party B)</span>
                            </div>
                        </label>
                        <textarea id="storyB" name="storyB" rows="10" class="input-field dark:bg-dark-surface dark:border-dark-border dark:text-dark-text-primary dark:placeholder-dark-text-secondary resize-none" placeholder="Enter the other party's perspective of the dispute. Include their claims, their version of events, their position, and any arguments they have presented. Try to represent their viewpoint fairly and completely." required></textarea>
                        <div class="flex justify-between text-sm text-text-secondary dark:text-dark-text-secondary">
                            <span>Minimum 50 characters recommended</span>
                            <span id="countB" class="font-mono">0 characters</span>
                        </div>
                    </div>

                    <!-- File Upload Section -->
                    <div class="space-y-4">
                        <label class="block text-lg font-inter font-semibold text-text-primary dark:text-dark-text-primary">
                            <div class="flex items-center space-x-2">
                                <svg class="w-5 h-5 text-text-secondary dark:text-dark-text-secondary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.172 7l-6.586 6.586a2 2 0 102.828 2.828l6.414-6.586a4 4 0 00-5.656-5.656l-6.415 6.585a6 6 0 108.486 8.486L20.5 13"/>
                                </svg>
                                <span>Supporting Documents (Optional)</span>
                            </div>
                        </label>
                        <div class="border-2 border-dashed border-border dark:border-dark-border rounded-lg p-6 text-center hover:border-accent-500 dark:hover:border-dark-accent-500 transition-colors duration-150 hover:bg-secondary-50 dark:hover:bg-dark-surface">
                            <input type="file" id="fileInput" name="files" multiple accept=".pdf,.txt,.png,.jpeg,.jpg" class="hidden" />
                            <label for="fileInput" class="cursor-pointer">
                                <div class="space-y-2">
                                    <svg class="w-12 h-12 text-text-secondary dark:text-dark-text-secondary mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
                                    </svg>
                                    <div class="text-text-primary dark:text-dark-text-primary font-medium">Click to upload files</div>
                                    <div class="text-sm text-text-secondary dark:text-dark-text-secondary">
                                        Supports PDF, TXT, PNG, JPEG, JPG files
                                    </div>
                                </div>
                            </label>
                        </div>
                        
                        <!-- Selected Files Display -->
                        <div id="fileList" class="hidden space-y-2">
                            <h4 class="font-inter font-semibold text-text-primary dark:text-dark-text-primary">Selected Files:</h4>
                            <div id="fileItems" class="space-y-2"></div>
                        </div>
                    </div>

                    <!-- Submit Button -->
                    <div class="text-center pt-4">
                        <button type="submit" id="solveButton" class="btn-primary dark:bg-dark-primary dark:hover:bg-dark-primary-600 text-lg px-8 py-4 min-w-48 font-inter font-semibold">
                            <span id="buttonText">Solve Dispute</span>
                            <svg id="buttonIcon" class="w-5 h-5 ml-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                        </button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Loading Indicator -->
        <section id="loadingSection" class="hidden max-w-4xl mx-auto mt-8 animate-fade-in">
            <div class="card dark:bg-dark-surface dark:border-dark-border text-center py-12">
                <div class="space-y-4">
                    <div class="w-16 h-16 border-4 border-accent-200 dark:border-dark-accent-200 border-t-accent-600 dark:border-t-dark-accent-600 rounded-full animate-spin mx-auto"></div>
                    <h3 class="text-xl font-inter font-bold text-text-primary dark:text-dark-text-primary">Analyzing Dispute...</h3>
                    <p class="text-text-secondary dark:text-dark-text-secondary">Our AI is carefully reviewing both perspectives and supporting documents</p>
                    <div class="w-64 mx-auto bg-secondary-200 dark:bg-dark-secondary-200 rounded-full h-2">
                        <div id="progressBar" class="progress-fill dark:bg-dark-accent-500 w-0 transition-all duration-500"></div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Results Display -->
        <section id="resultsSection" class="hidden max-w-4xl mx-auto mt-8">
            <div class="card-elevated dark:bg-dark-surface dark:border-dark-border">
                <div class="space-y-8">
                    <!-- Decision Header -->
                    <div class="text-center border-b border-border dark:border-dark-border pb-6 animate-slide-up">
                        <h2 class="text-2xl font-inter font-bold text-text-primary dark:text-dark-text-primary mb-2">AI Analysis Results</h2>
                        <p class="text-text-secondary dark:text-dark-text-secondary">Generated on <span id="analysisDate"></span></p>
                    </div>

                    <!-- Winner Determination -->
                    <div class="space-y-4 animate-slide-up animation-delay-100">
                        <h3 class="text-xl font-inter font-semibold text-text-primary dark:text-dark-text-primary flex items-center">
                            <svg class="w-6 h-6 text-success-600 dark:text-dark-success-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Decision
                        </h3>
                        <div id="winnerResult" class="p-4 rounded-lg border-l-4 border-success-500 dark:border-dark-success-500 bg-success-50 dark:bg-dark-success-50">
                            <p class="text-lg font-semibold text-success-800 dark:text-dark-success-800" id="winnerText"></p>
                        </div>
                    </div>

                    <!-- Detailed Reasoning -->
                    <div class="space-y-4 animate-slide-up animation-delay-200">
                        <h3 class="text-xl font-inter font-semibold text-text-primary dark:text-dark-text-primary flex items-center">
                            <svg class="w-6 h-6 text-primary-600 dark:text-dark-primary-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                            </svg>
                            Reasoning & Analysis
                        </h3>
                        <div class="bg-secondary-50 dark:bg-dark-secondary-50 rounded-lg p-6">
                            <div id="reasoningText" class="prose prose-slate dark:prose-invert max-w-none text-text-primary dark:text-dark-text-primary leading-relaxed"></div>
                        </div>
                    </div>

                    <!-- Confidence Score -->
                    <div class="space-y-4 animate-slide-up animation-delay-300">
                        <h3 class="text-xl font-inter font-semibold text-text-primary dark:text-dark-text-primary flex items-center">
                            <svg class="w-6 h-6 text-accent-600 dark:text-dark-accent-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                            Confidence Score
                        </h3>
                        <div class="flex items-center space-x-4">
                            <div class="flex-1">
                                <div class="bg-secondary-200 dark:bg-dark-secondary-200 rounded-full h-4">
                                    <div id="confidenceBar" class="bg-accent-500 dark:bg-dark-accent-500 h-4 rounded-full transition-all duration-500"></div>
                                </div>
                            </div>
                            <div class="text-right">
                                <span id="confidenceScore" class="text-2xl font-inter font-bold text-accent-600 dark:text-dark-accent-600"></span>
                                <span class="text-text-secondary dark:text-dark-text-secondary">%</span>
                            </div>
                        </div>
                        <p class="text-sm text-text-secondary dark:text-dark-text-secondary">
                            This score reflects the AI's confidence in its analysis based on the information provided.
                        </p>
                    </div>
                </div>
            </div>
        </section>

        <!-- Legal Disclaimer -->
        <section class="max-w-4xl mx-auto mt-12">
            <div class="bg-warning-50 dark:bg-dark-warning-50 border border-warning-200 dark:border-dark-warning-200 rounded-lg p-6">
                <div class="flex items-start space-x-3">
                    <svg class="w-6 h-6 text-warning-600 dark:text-dark-warning-600 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"/>
                    </svg>
                    <div class="space-y-2">
                        <h4 class="font-inter font-semibold text-warning-800 dark:text-dark-warning-800">Important Legal Disclaimer</h4>
                        <p class="text-sm text-warning-700 dark:text-dark-warning-700 leading-relaxed">
                            This AI analysis is provided for <strong>informational purposes only</strong> and is <strong>not legally binding</strong>. 
                            The results should not be considered as legal advice, professional consultation, or a substitute for proper legal proceedings. 
                            For official dispute resolution, please consult with qualified legal professionals or appropriate judicial authorities.
                        </p>
                        <p class="text-xs text-warning-600 dark:text-dark-warning-600">
                            © 2025 AI Dispute Solver. Analysis generated using advanced machine learning algorithms.
                        </p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-surface dark:bg-dark-surface border-t border-border dark:border-dark-border mt-16">
        <div class="container mx-auto px-4 py-8">
            <div class="text-center space-y-4">
                <div class="flex items-center justify-center space-x-2">
                    <div class="w-6 h-6 bg-primary rounded-md flex items-center justify-center">
                        <svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                    <span class="font-inter font-semibold text-text-primary">AI Dispute Solver</span>
                </div>
                <p class="text-sm text-text-secondary max-w-md mx-auto">
                    Empowering fair and efficient dispute resolution through advanced artificial intelligence technology.
                </p>
                <p class="text-xs text-text-secondary">
                    © 2025 AI Dispute Solver. All Rights Reserved.
                </p>
            </div>
        </div>
    </footer>

    <script>
        // DOM Elements
        const disputeForm = document.getElementById('disputeForm');
        const storyA = document.getElementById('storyA');
        const storyB = document.getElementById('storyB');
        const fileInput = document.getElementById('fileInput');
        const fileList = document.getElementById('fileList');
        const fileItems = document.getElementById('fileItems');
        const solveButton = document.getElementById('solveButton');
        const buttonText = document.getElementById('buttonText');
        const buttonIcon = document.getElementById('buttonIcon');
        const loadingSection = document.getElementById('loadingSection');
        const resultsSection = document.getElementById('resultsSection');
        const progressBar = document.getElementById('progressBar');
        const countA = document.getElementById('countA');
        const countB = document.getElementById('countB');

        // Result elements
        const analysisDate = document.getElementById('analysisDate');
        const winnerText = document.getElementById('winnerText');
        const reasoningText = document.getElementById('reasoningText');
        const confidenceScore = document.getElementById('confidenceScore');
        const confidenceBar = document.getElementById('confidenceBar');

        let selectedFiles = [];

        // Character counters
        storyA.addEventListener('input', () => {
            countA.textContent = `${storyA.value.length} characters`;
        });

        storyB.addEventListener('input', () => {
            countB.textContent = `${storyB.value.length} characters`;
        });

        // File handling
        fileInput.addEventListener('change', handleFileSelection);

        function handleFileSelection(event) {
            selectedFiles = Array.from(event.target.files);
            displaySelectedFiles();
        }

        function displaySelectedFiles() {
            if (selectedFiles.length === 0) {
                fileList.classList.add('hidden');
                return;
            }

            fileList.classList.remove('hidden');
            fileItems.innerHTML = '';

            selectedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'flex items-center justify-between p-3 bg-surface border border-border rounded-md animate-fade-in';
                
                const fileInfo = document.createElement('div');
                fileInfo.className = 'flex items-center space-x-3';
                
                const fileIcon = getFileIcon(file.type);
                const fileName = document.createElement('span');
                fileName.className = 'text-sm font-medium text-text-primary';
                fileName.textContent = file.name;
                
                const fileSize = document.createElement('span');
                fileSize.className = 'text-xs text-text-secondary';
                fileSize.textContent = formatFileSize(file.size);

                fileInfo.appendChild(fileIcon);
                fileInfo.appendChild(fileName);
                fileInfo.appendChild(fileSize);

                const removeButton = document.createElement('button');
                removeButton.type = 'button';
                removeButton.className = 'text-error-500 hover:text-error-600 p-1';
                removeButton.innerHTML = `
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                `;
                removeButton.addEventListener('click', () => removeFile(index, fileItem));

                fileItem.appendChild(fileInfo);
                fileItem.appendChild(removeButton);
                fileItems.appendChild(fileItem);
            });
        }

        function getFileIcon(fileType) {
            const icon = document.createElement('div');
            icon.className = 'w-8 h-8 rounded-md flex items-center justify-center text-white text-xs font-bold';
            
            if (fileType.includes('pdf')) {
                icon.className += ' bg-error-500';
                icon.textContent = 'PDF';
            } else if (fileType.includes('text')) {
                icon.className += ' bg-secondary-500';
                icon.textContent = 'TXT';
            } else if (fileType.includes('image')) {
                icon.className += ' bg-success-500';
                icon.textContent = 'IMG';
            } else {
                icon.className += ' bg-accent-500';
                icon.textContent = 'FILE';
            }
            
            return icon;
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function removeFile(index, fileItem) {
            fileItem.classList.add('animate-fade-out');
            setTimeout(() => {
                selectedFiles.splice(index, 1);
                displaySelectedFiles();

                // Update file input
                const dt = new DataTransfer();
                selectedFiles.forEach(file => dt.items.add(file));
                fileInput.files = dt.files;
            }, 300);
        }

        // Form submission
        disputeForm.addEventListener('submit', handleFormSubmission);

        async function handleFormSubmission(event) {
            event.preventDefault();
            
            // Validation
            if (storyA.value.trim().length < 50 || storyB.value.trim().length < 50) {
                alert('Please provide at least 50 characters for both stories to ensure adequate analysis.');
                return;
            }

            // Show loading state
            showLoadingState();

            try {
                // Process files
                const filesContent = await processFiles();
                
                // Prepare payload
                const payload = {
                    story_a: storyA.value.trim(),
                    story_b: storyB.value.trim(),
                    files_content: filesContent,
                    timestamp: new Date().toISOString()
                };

                // Simulate API call (replace with actual endpoint)
                const response = await simulateAPICall(payload);
                
                // Display results
                displayResults(response);
                
            } catch (error) {
                console.error('Error processing dispute:', error);
                showError('An error occurred while analyzing the dispute. Please try again.');
            }
        }

        async function processFiles() {
            const filesContent = [];
            
            for (const file of selectedFiles) {
                try {
                    const content = await readFile(file);
                    filesContent.push({
                        name: file.name,
                        type: file.type,
                        size: file.size,
                        content: content
                    });
                } catch (error) {
                    console.error(`Error reading file ${file.name}:`, error);
                }
            }
            
            return filesContent;
        }

        function readFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    if (file.type.startsWith('image/')) {
                        resolve(event.target.result); // Base64 for images
                    } else {
                        resolve(event.target.result); // Text content
                    }
                };
                
                reader.onerror = function() {
                    reject(new Error(`Failed to read file: ${file.name}`));
                };
                
                if (file.type.startsWith('image/')) {
                    reader.readAsDataURL(file);
                } else {
                    reader.readAsText(file);
                }
            });
        }

        function showLoadingState() {
            // Update button
            solveButton.disabled = true;
            buttonText.textContent = 'Analyzing...';
            buttonIcon.innerHTML = `
                <svg class="w-5 h-5 ml-2 inline animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
            `;

            // Show loading section
            loadingSection.classList.remove('hidden');
            resultsSection.classList.add('hidden');

            // Animate progress bar
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 90) progress = 90;
                progressBar.style.width = `${progress}%`;
            }, 200);

            // Store interval for cleanup
            window.progressInterval = progressInterval;
        }

        async function simulateAPICall(payload) {
            // Simulate network delay
            await new Promise(resolve => setTimeout(resolve, 3000 + Math.random() * 2000));
            
            // Complete progress bar
            if (window.progressInterval) {
                clearInterval(window.progressInterval);
                progressBar.style.width = '100%';
            }

            // Mock response based on input analysis
            const storyALength = payload.story_a.length;
            const storyBLength = payload.story_b.length;
            const hasFiles = payload.files_content.length > 0;
            
            // Simple mock logic for demonstration
            const winner = storyALength > storyBLength ? 'Party A' : 'Party B';
            const confidence = Math.min(95, 65 + Math.random() * 25 + (hasFiles ? 10 : 0));
            
            const mockReasons = [
                `Based on the detailed analysis of both perspectives, ${winner} presents a more comprehensive and substantiated case. The evidence provided demonstrates stronger factual support and clearer documentation of the disputed events.`,
                `The analysis reveals that ${winner} has provided more specific details and concrete examples that support their position. Their account shows greater consistency and includes relevant contextual information that strengthens their claims.`,
                `After careful evaluation of both narratives, ${winner} demonstrates superior evidence quality and logical coherence in their presentation. The supporting documentation further reinforces their position in this dispute.`
            ];

            return {
                success: true,
                winner: winner,
                reasoning: mockReasons[Math.floor(Math.random() * mockReasons.length)],
                confidence: Math.round(confidence * 100) / 100,
                analysis_date: new Date().toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                })
            };
        }

        function displayResults(response) {
            // Hide loading, show results
            loadingSection.classList.add('hidden');
            resultsSection.classList.remove('hidden');

            // Reset button
            solveButton.disabled = false;
            buttonText.textContent = 'Solve Another Dispute';
            buttonIcon.innerHTML = `
                <svg class="w-5 h-5 ml-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
            `;

            // Populate results
            analysisDate.textContent = response.analysis_date;
            winnerText.textContent = `Winner: ${response.winner}`;
            reasoningText.textContent = response.reasoning;
            confidenceScore.textContent = response.confidence.toFixed(2);
            confidenceBar.style.width = `${response.confidence}%`;

            // Update confidence bar color based on score
            if (response.confidence >= 80) {
                confidenceBar.className = 'bg-success-500 h-4 rounded-full transition-all duration-500';
            } else if (response.confidence >= 60) {
                confidenceBar.className = 'bg-warning-500 h-4 rounded-full transition-all duration-500';
            } else {
                confidenceBar.className = 'bg-error-500 h-4 rounded-full transition-all duration-500';
            }

            // Scroll to results
            resultsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function showError(message) {
            // Hide loading
            loadingSection.classList.add('hidden');
            
            // Reset button
            solveButton.disabled = false;
            buttonText.textContent = 'Solve Dispute';
            buttonIcon.innerHTML = `
                <svg class="w-5 h-5 ml-2 inline" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
            `;

            // Show error message
            alert(message);
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Focus on first textarea
            storyA.focus();
            
            // Clear any previous state
            resultsSection.classList.add('hidden');
            loadingSection.classList.add('hidden');
        });

        // Dark Mode Toggle
        const themeToggleBtn = document.getElementById('theme-toggle');
        const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
        const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

        // Change the icons inside the button based on previous settings
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            themeToggleLightIcon.classList.remove('hidden');
            themeToggleDarkIcon.classList.add('hidden');
            document.documentElement.classList.add('dark');
        } else {
            themeToggleDarkIcon.classList.remove('hidden');
            themeToggleLightIcon.classList.add('hidden');
            document.documentElement.classList.remove('dark');
        }

        themeToggleBtn.addEventListener('click', function() {
            // toggle icons inside button
            themeToggleDarkIcon.classList.toggle('hidden');
            themeToggleLightIcon.classList.toggle('hidden');

            // if set via local storage previously
            if (localStorage.getItem('color-theme')) {
                if (localStorage.getItem('color-theme') === 'light') {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                    themeToggleLightIcon.classList.add('animate-rotate-in');
                    themeToggleLightIcon.classList.remove('animate-rotate-out');
                } else {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                    themeToggleDarkIcon.classList.add('animate-rotate-in');
                    themeToggleDarkIcon.classList.remove('animate-rotate-out');
                }

            // if NOT set via local storage previously
            } else {
                if (document.documentElement.classList.contains('dark')) {
                    document.documentElement.classList.remove('dark');
                    localStorage.setItem('color-theme', 'light');
                    themeToggleDarkIcon.classList.add('animate-rotate-in');
                    themeToggleDarkIcon.classList.remove('animate-rotate-out');
                } else {
                    document.documentElement.classList.add('dark');
                    localStorage.setItem('color-theme', 'dark');
                    themeToggleLightIcon.classList.add('animate-rotate-in');
                    themeToggleLightIcon.classList.remove('animate-rotate-out');
                }
            }
        });
    </script>
<script id="dhws-dataInjector" src="../public/dhws-data-injector.js"></script>
</body>
</html>